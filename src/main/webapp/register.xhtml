<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Criar Conta</title>
    <meta content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <h:outputStylesheet library="css" name="register.css"/>
</h:head>

<h:body>
    <div class="main-container">
        <div class="form-section">
            <h1 class="login-title">
                Crie sua conta
                <span class="gradient-dot"></span>
            </h1>

            <h:form id="registerForm" styleClass="login-form">
                <!-- Mensagem de feedback global -->
                <h:panelGroup rendered="#{registerBean.showMessage}">
                    <div class="alert #{registerBean.success ? 'alert-success' : 'alert-error'}">
                        #{registerBean.message}
                    </div>
                </h:panelGroup>

                <div class="form-inputs-wrapper">
                    <!-- USERNAME com valida√ß√£o -->
                    <div class="input-group">
                        <label class="input-label" for="registerForm:username">Nome de usu√°rio</label>
                        <div class="input-container">
                            <p:inputText id="username"
                                         value="#{registerBean.username}"
                                         styleClass="auth-input"
                                         required="true">
                                <p:ajax event="blur"
                                        listener="#{registerBean.validateUsername}"
                                        update="username-status"
                                        process="@this"/>
                            </p:inputText>
                        </div>
                        <h:panelGroup id="username-status">
                            <h:outputText value="‚ùå Use apenas letras, n√∫meros e _ (3-50 caracteres)"
                                          style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                          rendered="#{registerBean.usernameInvalid}"/>
                        </h:panelGroup>
                    </div>

                    <!-- EMAIL com valida√ß√£o -->
                    <div class="input-group">
                        <label class="input-label" for="registerForm:email">Email</label>
                        <div class="input-container">
                            <p:inputText id="email"
                                         value="#{registerBean.email}"
                                         styleClass="auth-input"
                                         required="true">
                                <p:ajax event="blur"
                                        listener="#{registerBean.validateEmail}"
                                        update="email-status"
                                        process="@this"/>
                            </p:inputText>
                        </div>
                        <h:panelGroup id="email-status">
                            <h:outputText value="‚ùå Digite um email v√°lido (ex: usuario@exemplo.com)"
                                          style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                          rendered="#{registerBean.emailInvalid}"/>
                        </h:panelGroup>
                    </div>

                    <!-- NOMES com valida√ß√£o -->
                    <div class="row-double-input">
                        <div class="input-group">
                            <label class="input-label" for="registerForm:firstName">Nome</label>
                            <div class="input-container">
                                <p:inputText id="firstName"
                                             value="#{registerBean.firstName}"
                                             styleClass="auth-input"
                                             required="true">
                                    <p:ajax event="blur"
                                            update="firstname-status"
                                            process="@this"/>
                                </p:inputText>
                            </div>
                            <h:panelGroup id="firstname-status">
                                <h:outputText value="‚ùå Apenas letras (2-50 caracteres)"
                                              style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                              rendered="#{registerBean.firstNameInvalid}"/>
                            </h:panelGroup>
                        </div>

                        <div class="input-group">
                            <label class="input-label" for="registerForm:lastName">Sobrenome</label>
                            <div class="input-container">
                                <p:inputText id="lastName"
                                             value="#{registerBean.lastName}"
                                             styleClass="auth-input"
                                             required="true">
                                    <p:ajax event="blur"
                                            update="lastname-status"
                                            process="@this"/>
                                </p:inputText>
                            </div>
                            <h:panelGroup id="lastname-status">
                                <h:outputText value="‚ùå Apenas letras (2-50 caracteres)"
                                              style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                              rendered="#{registerBean.lastNameInvalid}"/>
                            </h:panelGroup>
                        </div>
                    </div>

                    <!-- ENDERE√áO com busca autom√°tica -->
                    <div class="row-address">
                        <!-- CEP -->
                        <div class="input-group">
                            <label class="input-label" for="registerForm:cep">CEP</label>
                            <div class="input-container">
                                <p:inputText id="cep"
                                             value="#{registerBean.cep}"
                                             styleClass="auth-input"
                                             required="true"
                                             maxlength="9">
                                    <p:ajax event="blur"
                                            listener="#{registerBean.buscarCep}"
                                            update="cep-status rua bairro cidade uf"
                                            process="@this"/>
                                </p:inputText>
                            </div>
                            <h:panelGroup id="cep-status">
                                <h:outputText value="üîç Buscando CEP..."
                                              style="font-size: 0.6rem; color: #818cf8; display: block; margin-top: 0.3rem;"
                                              rendered="#{registerBean.buscandoCep}"/>
                                <h:outputText value="‚ùå CEP deve ter 8 d√≠gitos (ex: 12345-678)"
                                              style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                              rendered="#{registerBean.cepInvalid and not registerBean.buscandoCep}"/>
                            </h:panelGroup>
                        </div>

                        <!-- Rua -->
                        <div class="input-group">
                            <label class="input-label" for="registerForm:rua">Rua</label>
                            <div class="input-container">
                                <p:inputText id="rua"
                                             value="#{registerBean.rua}"
                                             styleClass="auth-input"
                                             required="true"/>
                            </div>
                        </div>

                        <!-- N√∫mero -->
                        <div class="input-group">
                            <label class="input-label" for="registerForm:numero">N√∫mero</label>
                            <div class="input-container">
                                <p:inputText id="numero"
                                             value="#{registerBean.numero}"
                                             styleClass="auth-input"
                                             maxlength="10"
                                             required="true"/>
                            </div>
                        </div>
                    </div>

                    <div class="row-address">
                        <!-- Bairro -->
                        <div class="input-group">
                            <label class="input-label" for="registerForm:bairro">Bairro</label>
                            <div class="input-container">
                                <p:inputText id="bairro"
                                             value="#{registerBean.bairro}"
                                             styleClass="auth-input"
                                             required="true"/>
                            </div>
                        </div>

                        <!-- Cidade -->
                        <div class="input-group">
                            <label class="input-label" for="registerForm:cidade">Cidade</label>
                            <div class="input-container">
                                <p:inputText id="cidade"
                                             value="#{registerBean.cidade}"
                                             styleClass="auth-input"
                                             required="true"/>
                            </div>
                        </div>

                        <!-- UF -->
                        <div class="input-group">
                            <label class="input-label" for="registerForm:uf">UF</label>
                            <div class="input-container">
                                <p:inputText id="uf"
                                             value="#{registerBean.uf}"
                                             styleClass="auth-input"
                                             maxlength="2"
                                             required="true"/>
                            </div>
                        </div>
                    </div>

                    <!-- CARGO -->
                    <div class="input-group">
                        <label class="input-label" for="registerForm:cargo">Cargo</label>
                        <div class="input-container">
                            <p:selectOneMenu id="cargo"
                                             value="#{registerBean.cargo}"
                                             styleClass="auth-input"
                                             required="true"
                                             appendTo="@(body)">
                                <f:selectItem itemLabel="Selecione um cargo..."
                                              itemValue=""
                                              noSelectionOption="true"/>
                                <f:selectItem itemLabel="Operacional" itemValue="OPERATIONAL"/>
                                <f:selectItem itemLabel="Moderador" itemValue="MOD"/>
                                <f:selectItem itemLabel="Administrador" itemValue="ADMIN"/>
                            </p:selectOneMenu>
                        </div>
                    </div>

                    <!-- SENHAS com valida√ß√£o -->
                    <div class="input-group">
                        <label class="input-label" for="registerForm:password">Senha</label>
                        <div class="input-container">
                            <p:password id="password"
                                        value="#{registerBean.password}"
                                        styleClass="auth-input"
                                        required="true">
                                <p:ajax event="blur"
                                        update="password-status"
                                        process="@this"/>
                            </p:password>
                        </div>
                        <h:panelGroup id="password-status">
                            <h:outputText value="‚ùå Senha deve ter pelo menos 8 caracteres"
                                          style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                          rendered="#{registerBean.passwordInvalid}"/>
                        </h:panelGroup>
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="registerForm:confirmPassword">Confirmar senha</label>
                        <div class="input-container">
                            <p:password id="confirmPassword"
                                        value="#{registerBean.confirmPassword}"
                                        styleClass="auth-input"
                                        required="true">
                                <p:ajax event="blur"
                                        update="confirm-password-status"
                                        process="password confirmPassword"/>
                            </p:password>
                        </div>
                        <h:panelGroup id="confirm-password-status">
                            <h:outputText value="‚ùå As senhas n√£o coincidem"
                                          style="font-size: 0.6rem; color: #f87171; display: block; margin-top: 0.3rem;"
                                          rendered="#{registerBean.confirmPasswordInvalid}"/>
                        </h:panelGroup>
                    </div>
                </div>

                <!-- BOT√ÉO DE REGISTRO -->
                <p:commandButton value="Criar conta"
                                 action="#{registerBean.register}"
                                 styleClass="login-btn"
                                 update="@form"
                                 process="@form"/>

                <!-- LINK PARA LOGIN -->
                <h:link value="J√° tenho uma conta"
                        styleClass="register-link"
                        outcome="login"/>
            </h:form>
        </div>

        <!-- IMAGEM -->
        <div class="picture-section">
            <h:graphicImage library="img"
                            name="bg.jpg"
                            styleClass="background-image"
                            alt="Background"/>
        </div>
    </div>

</h:body>
</html>